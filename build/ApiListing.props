<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <GenerateAPIListing Condition="'$(GenerateAPIListing)' == '' AND '$(TargetFramework)' != 'netstandard2.0'">true</GenerateAPIListing>

    <_RefSourceOutputPath>$([System.IO.Directory]::GetParent('$(MSBuildThisFileDirectory)'))/../api/</_RefSourceOutputPath>
    <GenAPIAdditionalParameters>--exclude-attributes-list "$(MSBuildThisFileDirectory)ApiListing.exclude-attributes.txt" $(GenAPIAdditionalParameters)</GenAPIAdditionalParameters>
    <GenAPITargetPath>$(_RefSourceOutputPath)$(AssemblyName).$(TargetFramework).cs</GenAPITargetPath>
  </PropertyGroup>
  
  <ItemGroup>
    <PackageReference Include="Microsoft.DotNet.GenAPI" PrivateAssets="All" Version="7.0.0-beta.23060.4" />
  </ItemGroup>
  
  <Target
    Name="_AutoRunExportApi"
    Condition="'$(GenerateAPIListing)' == 'true'"
    AfterTargets="CoreBuild"
    DependsOnTargets="GenerateReferenceAssemblySource" />
</Project>
