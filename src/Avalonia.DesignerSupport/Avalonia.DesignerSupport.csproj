<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>$(AvsCurrentTargetFramework);$(AvsLegacyTargetFrameworks)</TargetFrameworks>
    <!-- WARNING! The designer support version number needs to be frozen 
         To allow projects that implement designer functionality to still
         work with newer versions of Avalonia. This version number only
         need change when there are breaking changes to designer support api.
    -->
    <Version>0.7.0</Version>
    <NoWarn>$(NoWarn);CS1591</NoWarn>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <NugetPackageName>Avalonia</NugetPackageName>
    <WebAppDir>$(MSBuildThisFileDirectory)Remote/HtmlTransport/webapp</WebAppDir>
  </PropertyGroup>
  <ItemGroup>
    <EmbeddedResource Include="Remote\HtmlTransport\webapp\build\**\*.gz" />
    <EmbeddedResource Condition="'$(Configuration)' == 'Debug'" Remove="Remote\HtmlTransport\webapp\build\**\*.map.gz" />
    <ProjectReference Include="..\Markup\Avalonia.Markup.Xaml\Avalonia.Markup.Xaml.csproj" />
    <ProjectReference Include="..\Markup\Avalonia.Markup\Avalonia.Markup.csproj" />
    <ProjectReference Include="..\Avalonia.Base\Avalonia.Base.csproj" />
    <ProjectReference Include="..\Avalonia.Controls\Avalonia.Controls.csproj" />
  </ItemGroup>

  <Target Name="BunInstall" Inputs="$(WebAppDir)\package.json" Outputs="$(WebAppDir)\node_modules\.install-stamp">
    <!-- We use bun packages as .NET tool, to avoid preinstalled node.js dependency -->
    <Exec Command="dnx Bun.Unofficial.Tool --yes -- install" WorkingDirectory="$(WebAppDir)" />
    <!-- Write the stamp file, so incremental builds work -->
    <Touch Files="$(WebAppDir)\node_modules\.install-stamp" AlwaysCreate="true" />
  </Target>
  <Target Name="BunRunBuild" DependsOnTargets="BunInstall" BeforeTargets="DispatchToInnerBuilds">
    <Exec Command="dnx Bun.Unofficial.Tool build.js" WorkingDirectory="$(WebAppDir)" />
  </Target>

</Project>
